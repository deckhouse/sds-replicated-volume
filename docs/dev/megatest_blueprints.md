# Megatest — Архитектурные схемы

Визуальная документация архитектуры megatest: диаграммы, схемы потоков данных и примеры.

---

# Часть 1: Основные компоненты (Volume Lifecycle)

## Общая архитектура

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              megatest                                        │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                         MultiVolume                                      ││
│  │                    (оркестратор/координатор)                             ││
│  │                                                                          ││
│  │   Управляет: max-volumes, step period, volume period                     ││
│  │   Запускает: экземпляры VolumeMain + PodDestroyers                       ││
│  └──────────────────────────────┬──────────────────────────────────────────┘│
│                                 │                                            │
│         ┌───────────────────────┼───────────────────────┐                   │
│         │                       │                       │                   │
│         ▼                       ▼                       ▼                   │
│  ┌─────────────┐         ┌─────────────┐         ┌─────────────┐           │
│  │ VolumeMain  │         │ VolumeMain  │   ...   │ VolumeMain  │           │
│  │   (RV-1)    │         │   (RV-2)    │         │   (RV-N)    │           │
│  └──────┬──────┘         └──────┬──────┘         └──────┬──────┘           │
│         │                       │                       │                   │
│         ▼                       ▼                       ▼                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     Под-раннеры для каждого RV                       │   │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐        │   │
│  │  │  volume-   │ │  volume-   │ │  replica-  │ │  replica-  │        │   │
│  │  │  checker   │ │  resizer   │ │  destroyer │ │  creator   │        │   │
│  │  └────────────┘ └────────────┘ └────────────┘ └────────────┘        │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │                       PodDestroyers (глобальные)                         ││
│  │   ┌────────────────────┐      ┌────────────────────┐                    ││
│  │   │  pod-destroyer     │      │  pod-destroyer     │                    ││
│  │   │  (поды агентов)    │      │  (поды контроллера)│                    ││
│  │   └────────────────────┘      └────────────────────┘                    ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
                    ┌───────────────────────────────┐
                    │   Дочерний кластер (K8s)      │
                    │                               │
                    │  ReplicatedVolume (RV)        │
                    │  ReplicatedVolumeReplica (RVR)│
                    │  PVC, Pod                     │
                    └───────────────────────────────┘
```

## MultiVolume — Поток оркестратора

```
┌─────────────────────────────────────────────────────────────────┐
│                      MultiVolume.Run()                           │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Запуск PodDestroyer (агент)  │
              │  Запуск PodDestroyer (ctrl)   │
              └───────────────┬───────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Главный цикл:                │◄─────────────────┐
              │  while ctx.Done() не закрыт   │                  │
              └───────────────┬───────────────┘                  │
                              │                                  │
                              ▼                                  │
              ┌───────────────────────────────┐                  │
              │  runningVolumes < maxVolumes? │                  │
              └───────────┬───────────────────┘                  │
                    Yes   │   No                                 │
                          │    │                                 │
                          ▼    │                                 │
              ┌─────────────────────────────┐                    │
              │  Случайный step = [1..volumeStep]                │
              │  for i := 0; i < step; i++ {                     │
              │    go VolumeMain.Run()       │                   │
              │  }                           │                   │
              └───────────────┬─────────────┘                    │
                              │                                  │
                              ▼                                  │
              ┌───────────────────────────────┐                  │
              │  Ожидание random(stepPeriod)  │                  │
              └───────────────┬───────────────┘                  │
                              │                                  │
                              └──────────────────────────────────┘
```

## VolumeMain — Жизненный цикл одного RV

```
┌─────────────────────────────────────────────────────────────────┐
│                      VolumeMain.Run()                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  1. Создание ReplicatedVolume │
              │     (RV + RVRs авто-созданы)  │
              └───────────────┬───────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  2. Ожидание RV.Ready         │
              │     (опрос conditions)        │
              └───────────────┬───────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  3. Запуск под-раннеров:      │
              │     • volume-checker          │
              │     • volume-resizer          │
              │     • replica-destroyer       │
              │     • replica-creator         │
              └───────────────┬───────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  4. Ожидание volumeLifetime   │
              │     (или ctx.Done)            │
              └───────────────┬───────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  5. Сигнал остановки раннерам │
              │     (cancel sub-context)      │
              └───────────────┬───────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  6. Удаление RV               │
              │     (RVRs каскадно удаляются) │
              └───────────────────────────────┘
```

## Под-раннеры — Параллельные операции

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           RV-1 Под-раннеры                                   │
│                                                                              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │
│  │  volume-checker │  │  volume-resizer │  │replica-destroyer│              │
│  │                 │  │                 │  │                 │              │
│  │  Цикл:          │  │  Цикл:          │  │  Цикл:          │              │
│  │  • Читает RV/RVR│  │  • Ждёт period  │  │  • Ждёт period  │              │
│  │  • Проверяет    │  │  • Патчит RV    │  │  • Выбирает RVR │              │
│  │    conditions   │  │    .spec.size   │  │  • Удаляет RVR  │              │
│  │  • Отслеживает  │  │    += step      │  │  • Ждёт recreate│              │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘              │
│                                                                              │
│  ┌─────────────────┐                                                        │
│  │ replica-creator │   Все раннеры разделяют контекст RV                    │
│  │                 │   Все останавливаются при отмене sub-context           │
│  │  Цикл:          │                                                        │
│  │  • Ждёт period  │                                                        │
│  │  • Создаёт RVR  │                                                        │
│  │  • Ждёт ready   │                                                        │
│  └─────────────────┘                                                        │
└─────────────────────────────────────────────────────────────────────────────┘
```

## volume-checker — Конечный автомат

```
                    ┌──────────────┐
                    │   Unknown    │ (начальное)
                    └──────┬───────┘
                           │ первое наблюдение
                           ▼
              ┌────────────────────────┐
              │   Healthy / Degraded   │◄─────────────┐
              │   (зависит от RV)      │              │
              └────────────┬───────────┘              │
                           │                          │
              ┌────────────┴────────────┐             │
              │                         │             │
         RV сломан             RV восстановлен       │
              │                         │             │
              ▼                         │             │
       ┌─────────────┐                  │             │
       │   Broken    │──────────────────┘             │
       │             │                                │
       └─────────────┘                                │
              │                                       │
              │ RV восстановлен                       │
              └───────────────────────────────────────┘

Отслеживаемая статистика:
  • transitionCount: всего смен состояния
  • brokenCount: переходы в Broken (нечётные)
  • recoveredCount: переходы из Broken (чётные)
```

---

# Часть 2: Chaos Engineering

## Архитектура Chaos-компонентов

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              megatest                                        │
│                                                                              │
│  ┌─────────────────────┐     ┌─────────────────────────────────────────────┐│
│  │   MultiVolume       │     │           Chaos-раннеры                       ││
│  │   (жизненный цикл RV)│    │                                              ││
│  │                     │     │  ┌─────────────┐  ┌─────────────┐           ││
│  │  volume-main        │     │  │ DRBD        │  │ Network     │           ││
│  │  volume-checker     │     │  │ Blocker     │  │ Blocker     │           ││
│  │  volume-resizer     │     │  └──────┬──────┘  └──────┬──────┘           ││
│  │  pod-destroyer      │     │         │                │                   ││
│  │  ...                │     │  ┌──────┴──────┐  ┌──────┴──────┐           ││
│  └─────────────────────┘     │  │ Network     │  │ Network     │           ││
│                              │  │ Degrader    │  │ Partitioner │           ││
│                              │  └──────┬──────┘  └──────┴──────┘           ││
│                              │         │                │                   ││
│                              │  ┌──────┴────────────────┴──────┐           ││
│                              │  │        VM Reboter            │           ││
│                              │  └──────────────┬───────────────┘           ││
│                              └─────────────────┼───────────────────────────┘│
└────────────────────────────────────────────────┼────────────────────────────┘
                                                 │
                 ┌───────────────────────────────┼───────────────────────────┐
                 │                               │                           │
                 ▼                               ▼                           ▼
┌─────────────────────────────┐  ┌─────────────────────────┐  ┌─────────────────────────┐
│   Дочерний кластер          │  │   Дочерний кластер      │  │  Родительский кластер   │
│     (--kubeconfig)          │  │     (--kubeconfig)      │  │  (--parent-kubeconfig)  │
│                             │  │                         │  │                         │
│  CiliumClusterwideNP        │  │  tc netem Jobs          │  │  VirtualMachine         │
│  (блокировка трафика)       │  │  (задержка/потери)      │  │  VirtualMachineOperation│
│                             │  │                         │  │  (перезагрузка)         │
│  RVR CRD                    │  │                         │  │                         │
│  (чтение DRBD портов)       │  │                         │  │  Список VM + IP         │
└─────────────────────────────┘  └─────────────────────────┘  └─────────────────────────┘
```

## Технологии и уровни в сетевом стеке

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      Путь пакета (исходящий)                                 │
│                                                                              │
│   Приложение                                                                 │
│       │                                                                      │
│       ▼                                                                      │
│   Уровень сокетов                                                            │
│       │                                                                      │
│       ▼                                                                      │
│   Решение маршрутизации                                                      │
│       │                                                                      │
│       ▼                                                                      │
│  ┌────────────────────────────────────────────┐                             │
│  │  tc qdisc (netem)                          │  ← Network Degrader         │
│  │  • delay: добавляет задержку               │    (chaos-network-degrader)  │
│  │  • loss: случайно отбрасывает пакеты       │                              │
│  │  • rate: ограничивает bandwidth            │                              │
│  │  • handles: 31337/31338 (уникальные)       │                              │
│  └────────────────────────────────────────────┘                             │
│       │                                                                      │
│       ▼                                                                      │
│  ┌────────────────────────────────────────────┐                             │
│  │  Cilium eBPF (XDP/tc-bpf)                  │  ← Network/DRBD Blocker     │
│  │  • ALLOW: пропускает пакет                 │    (CiliumClusterwideNP)     │
│  │  • DROP: отбрасывает пакет                 │                              │
│  └────────────────────────────────────────────┘                             │
│       │                                                                      │
│       ▼                                                                      │
│   Сетевой интерфейс (NIC)                                                    │
│       │                                                                      │
│       ▼                                                                      │
│   Провод / Сеть                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

Технологии НЕ конфликтуют:
  • tc netem модифицирует тайминг пакетов
  • Cilium eBPF решает: пропустить или заблокировать
```

## chaos-drbd-blocker — Поток выполнения

```
┌─────────────────────────────────────────────────────────────────┐
│                    chaos-drbd-blocker                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  Ожидание random(period_min/max)│◄────────────┐
              └───────────────┬───────────────┘               │
                              ▼                               │
              ┌───────────────────────────────┐               │
              │  ParentClient.ListVMs()       │               │
              │  → Получаем имена нод + IP    │               │
              └───────────────┬───────────────┘               │
                              ▼                               │
              ┌───────────────────────────────┐               │
              │  Выбираем случайные nodeA, nodeB│              │
              └───────────────┬───────────────┘               │
                              ▼                               │
              ┌───────────────────────────────┐               │
              │  DRBDPortCollector            │               │
              │  .CollectPortsFromAllNodes()  │               │
              │  → Листинг RVRs через K8s API │               │
              │  → Извлечение портов из       │               │
              │    rvr.status.drbd.config     │               │
              │    .address.port              │               │
              └───────────────┬───────────────┘               │
                              ▼                               │
                    ┌─────────────────┐                       │
                    │ порты найдены?  │                       │
                    └────────┬────────┘                       │
                   Нет       │        Да                      │
                    │        ▼         │                      │
                    │  ┌───────────────────────────┐          │
                    │  │  CiliumManager            │          │
                    │  │  .BlockDRBDPortsList()    │          │
                    │  │  → Создание CCNP          │          │
                    │  └───────────────┬───────────┘          │
                    │                  ▼                      │
                    │  ┌───────────────────────────┐          │
                    │  │  Ожидание incident_duration│         │
                    │  └───────────────┬───────────┘          │
                    │                  ▼                      │
                    │  ┌───────────────────────────┐          │
                    │  │  CiliumManager            │          │
                    │  │  .UnblockTraffic()        │          │
                    │  │  → Удаление CCNP          │          │
                    │  └───────────────┬───────────┘          │
                    │                  │                      │
                    └──────► пропуск ──┴──────────────────────┘
                              (цикл)
```

## chaos-network-degrader — Поток выполнения (tc netem)

```
┌─────────────────────────────────────────────────────────────────┐
│                   chaos-network-degrader                         │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │ Ожидание random(period_min/max)│◄─────────────────┐
              └───────────────┬───────────────┘                  │
                              ▼                                  │
              ┌───────────────────────────────┐                  │
              │  Выбираем случайные nodeA, nodeB│                │
              │  Выбираем delay, jitter, loss, rate│             │
              └───────────────┬───────────────┘                  │
                              ▼                                  │
              ┌───────────────────────────────┐                  │
              │  NetemManager                 │                  │
              │  .ApplyNetworkDegradation()   │                  │
              │  → Создание K8s Job на nodeA  │                  │
              └───────────────┬───────────────┘                  │
                              ▼                                  │
┌─────────────────────────────────────────────────────────────────────────────┐
│                        K8s Job на nodeA                                      │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │  Контейнер: alpine + iproute2                                          │ │
│  │  hostNetwork: true, hostPID: true, privileged: true                    │ │
│  │                                                                        │ │
│  │  Скрипт:                                                               │ │
│  │  1. IFACE=$(ip route get $TARGET_IP | grep dev | awk '{print $3}')     │ │
│  │  2. tc qdisc add dev $IFACE root handle 31337: prio                    │ │
│  │  3. tc qdisc add dev $IFACE parent 31337:3 handle 31338: \             │ │
│  │        netem delay ${DELAY}ms ${JITTER}ms loss ${LOSS}% [rate Xkbit]   │ │
│  │  4. tc filter add dev $IFACE protocol ip parent 31337:0 prio 3 \       │ │
│  │        u32 match ip dst $TARGET_IP/32 flowid 31337:3                   │ │
│  │  5. sleep (incident_duration + 120s буфер)                             │ │
│  │  6. tc qdisc del dev $IFACE root  ← авто-очистка (fallback)            │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ┌───────────────────────────────┐
              │  megatest: Ожидание incident_dur│
              └───────────────┬───────────────┘
                              ▼
              ┌───────────────────────────────┐
              │  NetemManager                 │
              │  .RemoveNetworkDegradation()  │
              │  → Создание cleanup Job       │
              │  → Поиск handles 31337/31338  │
              │  → tc qdisc del dev $IFACE    │
              └───────────────┬───────────────┘
                              │
                              └──────────────────────────────────┘
                                          (цикл)
```

## CiliumClusterwideNetworkPolicy — Пример

```yaml
# Создаётся chaos-drbd-blocker или chaos-network-blocker
apiVersion: cilium.io/v2
kind: CiliumClusterwideNetworkPolicy
metadata:
  name: chaos-drbd-node1-node2-1737123456
  labels:
    chaos.megatest/type: drbd-block      # or: network-block, network-partition
    chaos.megatest/node-a: node1
    chaos.megatest/node-b: node2
spec:
  # Применяется к конкретной ноде (Host Firewall)
  nodeSelector:
    matchLabels:
      kubernetes.io/hostname: node1
  
  # Блокирует входящий трафик ОТ node2
  ingressDeny:
    - fromCIDR: ["10.0.0.2/32"]
      toPorts:                           # опционально: только конкретные порты
        - ports:
          - port: "7000"
            protocol: TCP
          - port: "7001"
            protocol: TCP
  
  # Блокирует исходящий трафик К node2
  egressDeny:
    - toCIDR: ["10.0.0.2/32"]
      toPorts:
        - ports:
          - port: "7000"
          - port: "7001"
```

## chaos-network-partitioner — Разделение сети (Split Brain)

```
                        До разделения:
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│    node1 ◄────────► node2 ◄────────► node3 ◄────────► node4    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘

                        После разделения (group_size=1):
┌───────────────────────┐         ┌───────────────────────────────┐
│    Группа A           │    ✕    │           Группа B            │
│                       │заблокир.│                               │
│    node1              │◄───────►│    node2 ◄──► node3 ◄──► node4│
│                       │         │                               │
└───────────────────────┘         └───────────────────────────────┘

Создаваемые политики:
  • chaos-partition-node1-node2-xxx: node1 блокирует node2
  • chaos-partition-node1-node3-xxx: node1 блокирует node3
  • chaos-partition-node1-node4-xxx: node1 блокирует node4
  • chaos-partition-node2-node1-xxx: node2 блокирует node1
  • chaos-partition-node3-node1-xxx: node3 блокирует node1
  • chaos-partition-node4-node1-xxx: node4 блокирует node1
```

## Поток очистки (Cleanup Flow)

```
┌─────────────────────────────────────────────────────────────────┐
│                    Завершение / SIGTERM                          │
└────────────────────────────┬────────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────┐
│  1. ctx.Done() → Все раннеры выходят из своих циклов            │
│                                                                 │
│  2. Ожидание завершения всех chaos горутин (wg.Wait())          │
│                                                                 │
│  3. Очистка (таймаут 3 мин):                                    │
│                                                                 │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │  CiliumManager.CleanupAllChaosPolicies()                │ │
│     │  → Листинг CCNP с лейблом chaos.megatest/*              │ │
│     │  → Удаление каждой политики                             │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                 │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │  NetemManager.CleanupAllNetemJobs()                     │ │
│     │  → Поиск нод с активными tc правилами                   │ │
│     │  → Создание cleanup Job для каждой ноды                 │ │
│     │  → Удаление всех netem Jobs (каскадное удаление Pods)   │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                 │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │  ParentClient.CleanupVMOperations()                     │ │
│     │  → Листинг VMOperations с chaos лейблами                │ │
│     │  → Удаление каждой операции                             │ │
│     └─────────────────────────────────────────────────────────┘ │
│                                                                 │
│     ┌─────────────────────────────────────────────────────────┐ │
│     │  DRBDPortCollector.CleanupCollectorJobs()               │ │
│     │  → No-op (используется RVR CRD, Jobs не создаются)      │ │
│     └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## Механизмы безопасности (Safety Mechanisms)

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Механизмы безопасности                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  1. Авто-очистка tc netem:                                                   │
│     ┌───────────────────────────────────────────────────────────────────┐   │
│     │  Job спит: incident_duration + 120s буфер                         │   │
│     │  Если megatest упадёт → Job сам очистит tc правила по таймауту    │   │
│     └───────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  2. Уникальные tc handles:                                                   │
│     ┌───────────────────────────────────────────────────────────────────┐   │
│     │  Используются 31337/31338 (leet speak) - крайне маловероятная     │   │
│     │  коллизия. Cleanup находит правила по структуре, не по маркерам   │   │
│     └───────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  3. Очистка устаревших ресурсов при старте:                                  │
│     ┌───────────────────────────────────────────────────────────────────┐   │
│     │  • CleanupStaleChaosPolicies() - удаление оставшихся CCNP         │   │
│     │  • CleanupStaleNetemJobs() - удаление Jobs + запуск cleanup       │   │
│     │  • CleanupStaleVMOperations() - удаление оставшихся VMOps         │   │
│     └───────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  4. Лейблы для отслеживания:                                                 │
│     ┌───────────────────────────────────────────────────────────────────┐   │
│     │  chaos.megatest/type: drbd-block | network-block | network-degrade│   │
│     │  chaos.megatest/node-a: <node-name>                               │   │
│     │  chaos.megatest/node-b: <node-name>                               │   │
│     └───────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  5. forceCleanupChan (второй Ctrl+C):                                        │
│     ┌───────────────────────────────────────────────────────────────────┐   │
│     │  Первый SIGTERM → graceful shutdown, начинается cleanup           │   │
│     │  Второй SIGTERM → broadcast всем раннерам через закрытый канал    │   │
│     │                   раннеры прерывают ожидание, cleanup продолжается│   │
│     └───────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

# Часть 3: Примеры CLI

## Базовый тест жизненного цикла RV

```bash
# Простой тест: 10 RV, без chaos
megatest \
  --kubeconfig ~/.kube/config \
  --storage-classes linstor-r2 \
  --max-volumes 10 \
  --log-level info
```

## Полный Chaos-тест

```bash
# Полный тест: жизненный цикл RV + все chaos-раннеры
megatest \
  --kubeconfig ~/.kube/child-config \
  --parent-kubeconfig ~/.kube/parent-config \
  --vm-namespace d8-cloud-test \
  --storage-classes linstor-r2,linstor-r3 \
  --max-volumes 50 \
  \
  --enable-chaos-drbd-block \
  --enable-chaos-network-block \
  --enable-chaos-network-degrade \
  --enable-chaos-vm-reboot \
  --enable-chaos-network-partition \
  \
  --chaos-period-min 60s \
  --chaos-period-max 300s \
  --chaos-incident-min 10s \
  --chaos-incident-max 60s \
  \
  --chaos-delay-ms-min 30 \
  --chaos-delay-ms-max 60 \
  --chaos-loss-percent-min 1.0 \
  --chaos-loss-percent-max 10.0 \
  --chaos-rate-mbit-min 5 \
  --chaos-rate-mbit-max 50 \
  --chaos-partition-group-size 1 \
  \
  --log-level debug
```

## Выборочный Chaos

```bash
# Только деградация сети (latency/loss) без полной блокировки
megatest \
  --kubeconfig ~/.kube/child-config \
  --parent-kubeconfig ~/.kube/parent-config \
  --vm-namespace d8-cloud-test \
  --storage-classes linstor-r2 \
  --max-volumes 20 \
  \
  --enable-chaos-network-degrade \
  --chaos-delay-ms-min 50 \
  --chaos-delay-ms-max 100 \
  --chaos-loss-percent-min 5.0 \
  --chaos-loss-percent-max 15.0
```

