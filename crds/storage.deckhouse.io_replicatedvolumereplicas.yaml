---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  labels:
    module: sds-replicated-volume
  name: replicatedvolumereplicas.storage.deckhouse.io
spec:
  group: storage.deckhouse.io
  names:
    kind: ReplicatedVolumeReplica
    listKind: ReplicatedVolumeReplicaList
    plural: replicatedvolumereplicas
    shortNames:
    - rvr
    singular: replicatedvolumereplica
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.replicatedVolumeName
      name: Volume
      type: string
    - jsonPath: .spec.nodeName
      name: Node
      type: string
    - jsonPath: .spec.type
      name: Type
      type: string
    - jsonPath: .status.conditions[?(@.type=='Attached')].status
      name: Attached
      type: string
    - jsonPath: .status.conditions[?(@.type=='Online')].status
      name: Online
      type: string
    - jsonPath: .status.conditions[?(@.type=='Ready')].status
      name: Ready
      type: string
    - jsonPath: .status.conditions[?(@.type=='Configured')].status
      name: Configured
      type: string
    - jsonPath: .status.conditions[?(@.type=='DataInitialized')].status
      name: DataInitialized
      type: string
    - jsonPath: .status.conditions[?(@.type=='InQuorum')].status
      name: InQuorum
      type: string
    - jsonPath: .status.syncProgress
      name: InSync
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ReplicatedVolumeReplica is a Kubernetes Custom Resource that
          represents a replica of a ReplicatedVolume.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            properties:
              lvmVolumeGroupName:
                description: LVMVolumeGroupName is the LVMVolumeGroup resource name
                  where this replica should be placed.
                minLength: 1
                pattern: ^[a-z0-9]([a-z0-9-.]{0,251}[a-z0-9])?$
                type: string
              lvmVolumeGroupThinPoolName:
                description: LVMVolumeGroupThinPoolName is the thin pool name (for
                  LVMThin storage pools).
                type: string
              nodeName:
                maxLength: 253
                minLength: 1
                type: string
                x-kubernetes-validations:
                - message: nodeName is immutable once set
                  rule: oldSelf == '' || self == oldSelf
              replicatedVolumeName:
                maxLength: 120
                minLength: 1
                pattern: ^[0-9A-Za-z.+_-]*$
                type: string
                x-kubernetes-validations:
                - message: replicatedVolumeName is immutable
                  rule: self == oldSelf
              type:
                description: ReplicaType enumerates possible values for ReplicatedVolumeReplica
                  spec.type and status.effectiveType fields.
                enum:
                - Diskful
                - Access
                - TieBreaker
                type: string
            required:
            - replicatedVolumeName
            - type
            type: object
            x-kubernetes-validations:
            - message: lvmVolumeGroupName requires nodeName to be set
              rule: size(self.lvmVolumeGroupName) == 0 || size(self.nodeName) > 0
            - message: lvmVolumeGroupName can only be set for Diskful type
              rule: size(self.lvmVolumeGroupName) == 0 || self.type == 'Diskful'
            - message: lvmVolumeGroupThinPoolName requires lvmVolumeGroupName to be
                set
              rule: size(self.lvmVolumeGroupThinPoolName) == 0 || size(self.lvmVolumeGroupName)
                > 0
          status:
            properties:
              addresses:
                items:
                  properties:
                    address:
                      properties:
                        ipv4:
                          pattern: ^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$
                          type: string
                        port:
                          maximum: 65535
                          minimum: 1025
                          type: integer
                      required:
                      - ipv4
                      - port
                      type: object
                    systemNetworkName:
                      maxLength: 64
                      type: string
                  required:
                  - address
                  - systemNetworkName
                  type: object
                maxItems: 32
                type: array
              backingVolumeSize:
                anyOf:
                - type: integer
                - type: string
                description: |-
                  BackingVolumeSize is the size of the backing LVM logical volume for this replica.
                  Only set for Diskful replicas.
                pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                x-kubernetes-int-or-string: true
              conditions:
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              datameshRevision:
                description: DatameshRevision is the datamesh revision this replica
                  was configured for.
                format: int64
                type: integer
              drbd:
                properties:
                  actual:
                    properties:
                      allowTwoPrimaries:
                        default: false
                        type: boolean
                      disk:
                        maxLength: 256
                        pattern: ^(/[a-zA-Z0-9/.+_-]+)?$
                        type: string
                      initialSyncCompleted:
                        default: false
                        type: boolean
                    type: object
                  config:
                    properties:
                      address:
                        properties:
                          ipv4:
                            pattern: ^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$
                            type: string
                          port:
                            maximum: 65535
                            minimum: 1025
                            type: integer
                        required:
                        - ipv4
                        - port
                        type: object
                      peers:
                        additionalProperties:
                          properties:
                            address:
                              properties:
                                ipv4:
                                  pattern: ^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$
                                  type: string
                                port:
                                  maximum: 65535
                                  minimum: 1025
                                  type: integer
                              required:
                              - ipv4
                              - port
                              type: object
                            diskless:
                              default: false
                              type: boolean
                            nodeId:
                              maximum: 7
                              minimum: 0
                              type: integer
                          required:
                          - address
                          - nodeId
                          type: object
                        description: |-
                          Peers contains information about other replicas in the same ReplicatedVolume.
                          The key in this map is the node name where the peer replica is located.
                        type: object
                      peersInitialized:
                        description: |-
                          PeersInitialized indicates that Peers has been calculated.
                          This field is used to distinguish between no peers and not yet calculated.
                        type: boolean
                      primary:
                        type: boolean
                    type: object
                  status:
                    properties:
                      connections:
                        items:
                          properties:
                            congested:
                              type: boolean
                            connectionState:
                              type: string
                            name:
                              type: string
                            paths:
                              items:
                                properties:
                                  established:
                                    type: boolean
                                  remoteHost:
                                    properties:
                                      address:
                                        type: string
                                      family:
                                        type: string
                                      port:
                                        type: integer
                                    required:
                                    - address
                                    - family
                                    - port
                                    type: object
                                  thisHost:
                                    properties:
                                      address:
                                        type: string
                                      family:
                                        type: string
                                      port:
                                        type: integer
                                    required:
                                    - address
                                    - family
                                    - port
                                    type: object
                                required:
                                - established
                                - remoteHost
                                - thisHost
                                type: object
                              type: array
                            peerDevices:
                              items:
                                properties:
                                  hasOnlineVerifyDetails:
                                    type: boolean
                                  hasSyncDetails:
                                    type: boolean
                                  outOfSync:
                                    type: integer
                                  peerClient:
                                    type: boolean
                                  peerDiskState:
                                    type: string
                                  percentInSync:
                                    type: string
                                  replicationState:
                                    type: string
                                  resyncSuspended:
                                    type: string
                                  volume:
                                    type: integer
                                required:
                                - hasOnlineVerifyDetails
                                - hasSyncDetails
                                - outOfSync
                                - peerClient
                                - peerDiskState
                                - percentInSync
                                - replicationState
                                - resyncSuspended
                                - volume
                                type: object
                              type: array
                            peerNodeId:
                              type: integer
                            peerRole:
                              type: string
                            tls:
                              type: boolean
                          required:
                          - congested
                          - connectionState
                          - name
                          - paths
                          - peerDevices
                          - peerNodeId
                          - peerRole
                          - tls
                          type: object
                        type: array
                      devices:
                        items:
                          properties:
                            client:
                              type: boolean
                            diskState:
                              type: string
                            minor:
                              type: integer
                            open:
                              type: boolean
                            quorum:
                              type: boolean
                            size:
                              type: integer
                            volume:
                              type: integer
                          required:
                          - client
                          - diskState
                          - minor
                          - open
                          - quorum
                          - size
                          - volume
                          type: object
                        type: array
                      forceIOFailures:
                        type: boolean
                      name:
                        type: string
                      nodeId:
                        type: integer
                      role:
                        type: string
                      suspended:
                        type: boolean
                      suspendedFencing:
                        type: boolean
                      suspendedNoData:
                        type: boolean
                      suspendedQuorum:
                        type: boolean
                      suspendedUser:
                        type: boolean
                      writeOrdering:
                        type: string
                    required:
                    - connections
                    - devices
                    - forceIOFailures
                    - name
                    - nodeId
                    - role
                    - suspended
                    - suspendedFencing
                    - suspendedNoData
                    - suspendedQuorum
                    - suspendedUser
                    - writeOrdering
                    type: object
                type: object
              drbdResourceGeneration:
                description: |-
                  DRBDResourceGeneration is the generation of the DRBDResource that was last applied.
                  Used to skip redundant spec comparison when the generation matches.
                format: int64
                type: integer
              effectiveType:
                description: ReplicaType enumerates possible values for ReplicatedVolumeReplica
                  spec.type and status.effectiveType fields.
                enum:
                - Diskful
                - Access
                - TieBreaker
                type: string
            type: object
        required:
        - metadata
        - spec
        type: object
        x-kubernetes-validations:
        - message: metadata.name must start with spec.replicatedVolumeName + '-'
          rule: self.metadata.name.startsWith(self.spec.replicatedVolumeName + '-')
        - message: numeric suffix must be between 0 and 31
          rule: int(self.metadata.name.substring(self.metadata.name.lastIndexOf('-')
            + 1)) <= 31
        - message: metadata.name must be at most 123 characters (to fit derived LLV
            name with prefix)
          rule: size(self.metadata.name) <= 123
    selectableFields:
    - jsonPath: .spec.nodeName
    - jsonPath: .spec.replicatedVolumeName
    served: true
    storage: true
    subresources:
      status: {}
