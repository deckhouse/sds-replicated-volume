---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  labels:
    module: sds-replicated-volume
  name: replicatedvolumes.storage.deckhouse.io
spec:
  group: storage.deckhouse.io
  names:
    kind: ReplicatedVolume
    listKind: ReplicatedVolumeList
    plural: replicatedvolumes
    shortNames:
    - rv
    singular: replicatedvolume
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.conditions[?(@.type=='IOReady')].status
      name: IOReady
      type: string
    - jsonPath: .status.conditions[?(@.type=='Quorum')].status
      name: Quorum
      type: string
    - jsonPath: .status.conditions[?(@.type=='Scheduled')].status
      name: Scheduled
      type: string
    - jsonPath: .status.conditions[?(@.type=='Configured')].status
      name: Configured
      type: string
    - jsonPath: .spec.size
      name: Size
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    - jsonPath: .status.conditions[?(@.type=='ConfigurationReady')].status
      name: ConfigurationReady
      priority: 1
      type: string
    - jsonPath: .status.conditions[?(@.type=='SatisfyEligibleNodes')].status
      name: SatisfyEligibleNodes
      priority: 1
      type: string
    - jsonPath: .spec.replicatedStorageClassName
      name: StorageClass
      priority: 1
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              Auto mode requires RSC name, forbids manualConfiguration:
              Manual mode requires manualConfiguration, forbids RSC name:
            properties:
              configurationMode:
                default: Auto
                description: |-
                  ConfigurationMode selects how the volume configuration is determined.
                  Auto (default): configuration is derived from the referenced ReplicatedStorageClass.
                  Manual: configuration is specified directly in the manualConfiguration field.
                enum:
                - Auto
                - Manual
                type: string
              manualConfiguration:
                description: |-
                  ManualConfiguration specifies the volume configuration directly.
                  Required when configurationMode is Manual. Must not be set when configurationMode is Auto.
                properties:
                  failuresToTolerate:
                    description: FailuresToTolerate is the resolved FTT value.
                    maximum: 2
                    minimum: 0
                    type: integer
                  guaranteedMinimumDataRedundancy:
                    description: GuaranteedMinimumDataRedundancy is the resolved GMDR
                      value.
                    maximum: 2
                    minimum: 0
                    type: integer
                  replicatedStoragePoolName:
                    description: ReplicatedStoragePoolName is the name of the ReplicatedStoragePool
                      resource.
                    minLength: 1
                    type: string
                  topology:
                    description: Topology is the resolved topology setting.
                    enum:
                    - TransZonal
                    - Zonal
                    - Ignored
                    type: string
                  volumeAccess:
                    description: VolumeAccess is the resolved volume access mode.
                    enum:
                    - Local
                    - EventuallyLocal
                    - PreferablyLocal
                    - Any
                    type: string
                required:
                - failuresToTolerate
                - guaranteedMinimumDataRedundancy
                - replicatedStoragePoolName
                - topology
                - volumeAccess
                type: object
                x-kubernetes-validations:
                - message: 'Invalid failuresToTolerate/guaranteedMinimumDataRedundancy
                    combination: |FTT - GMDR| must be <= 1.'
                  rule: self.failuresToTolerate - self.guaranteedMinimumDataRedundancy
                    <= 1 && self.guaranteedMinimumDataRedundancy - self.failuresToTolerate
                    <= 1
                - message: failuresToTolerate=0 with guaranteedMinimumDataRedundancy=0
                    requires topology Ignored.
                  rule: '!(self.failuresToTolerate == 0 && self.guaranteedMinimumDataRedundancy
                    == 0) || self.topology == ''Ignored'''
              maxAttachments:
                default: 1
                description: |-
                  MaxAttachments is the maximum number of nodes this volume can be attached to simultaneously.

                  WARNING: Values greater than 1 enable multi-attach mode. In this mode the block device
                  is writable from multiple nodes concurrently. The consuming application MUST guarantee
                  that it never writes to the same disk regions from different nodes simultaneously.
                  In particular:
                    - Mounting the volume as a regular filesystem (ext4, xfs, etc.) from more than one node
                      is NOT safe unless ALL mounts are read-only. Use a cluster-aware filesystem (e.g. GFS2,
                      OCFS2) or application-level coordination instead.
                    - Concurrent writes to overlapping regions from different nodes produce UNDEFINED behavior:
                      different Diskful replicas may apply writes in different order, leading to divergent data.
                    - Use at your own risk and with full understanding of the implications.
                maximum: 32
                minimum: 1
                type: integer
              replicatedStorageClassName:
                description: |-
                  ReplicatedStorageClassName references the RSC that provides configuration.
                  Required when configurationMode is Auto. Must not be set when configurationMode is Manual.
                minLength: 1
                type: string
              size:
                anyOf:
                - type: integer
                - type: string
                pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                x-kubernetes-int-or-string: true
                x-kubernetes-validations:
                - message: size must be greater than 0
                  rule: quantity(string(self)).isGreaterThan(quantity('0'))
            required:
            - maxAttachments
            - size
            type: object
            x-kubernetes-validations:
            - message: Auto mode requires replicatedStorageClassName and must not
                have manualConfiguration.
              rule: self.configurationMode != 'Auto' || (size(self.replicatedStorageClassName)
                > 0 && !has(self.manualConfiguration))
            - message: Manual mode requires manualConfiguration and must not have
                replicatedStorageClassName.
              rule: self.configurationMode != 'Manual' || (has(self.manualConfiguration)
                && size(self.replicatedStorageClassName) == 0)
          status:
            properties:
              actuallyAttachedTo:
                items:
                  type: string
                maxItems: 2
                type: array
                x-kubernetes-list-type: atomic
                x-kubernetes-validations:
                - message: actuallyAttachedTo must be unique
                  rule: self.all(x, self.exists_one(y, x == y))
              conditions:
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              configuration:
                description: Configuration is the desired configuration snapshot for
                  this volume.
                properties:
                  failuresToTolerate:
                    description: FailuresToTolerate is the resolved FTT value.
                    maximum: 2
                    minimum: 0
                    type: integer
                  guaranteedMinimumDataRedundancy:
                    description: GuaranteedMinimumDataRedundancy is the resolved GMDR
                      value.
                    maximum: 2
                    minimum: 0
                    type: integer
                  replicatedStoragePoolName:
                    description: ReplicatedStoragePoolName is the name of the ReplicatedStoragePool
                      resource.
                    minLength: 1
                    type: string
                  topology:
                    description: Topology is the resolved topology setting.
                    enum:
                    - TransZonal
                    - Zonal
                    - Ignored
                    type: string
                  volumeAccess:
                    description: VolumeAccess is the resolved volume access mode.
                    enum:
                    - Local
                    - EventuallyLocal
                    - PreferablyLocal
                    - Any
                    type: string
                required:
                - failuresToTolerate
                - guaranteedMinimumDataRedundancy
                - replicatedStoragePoolName
                - topology
                - volumeAccess
                type: object
                x-kubernetes-validations:
                - message: 'Invalid failuresToTolerate/guaranteedMinimumDataRedundancy
                    combination: |FTT - GMDR| must be <= 1.'
                  rule: self.failuresToTolerate - self.guaranteedMinimumDataRedundancy
                    <= 1 && self.guaranteedMinimumDataRedundancy - self.failuresToTolerate
                    <= 1
                - message: failuresToTolerate=0 with guaranteedMinimumDataRedundancy=0
                    requires topology Ignored.
                  rule: '!(self.failuresToTolerate == 0 && self.guaranteedMinimumDataRedundancy
                    == 0) || self.topology == ''Ignored'''
              configurationGeneration:
                description: ConfigurationGeneration is the RSC generation from which
                  configuration was taken.
                format: int64
                type: integer
              configurationObservedGeneration:
                description: ConfigurationObservedGeneration is the RSC generation
                  when configuration was last observed/acknowledged.
                format: int64
                type: integer
              datamesh:
                description: Datamesh is the computed datamesh configuration for the
                  volume.
                properties:
                  members:
                    default: []
                    description: Members is the list of datamesh members.
                    items:
                      description: DatameshMember represents a member of the datamesh.
                      properties:
                        addresses:
                          description: Addresses is the list of DRBD addresses for
                            this member.
                          items:
                            properties:
                              address:
                                properties:
                                  ipv4:
                                    maxLength: 15
                                    pattern: ^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$
                                    type: string
                                  port:
                                    maximum: 65535
                                    minimum: 1025
                                    type: integer
                                required:
                                - ipv4
                                - port
                                type: object
                              systemNetworkName:
                                maxLength: 64
                                type: string
                            required:
                            - address
                            - systemNetworkName
                            type: object
                          maxItems: 10
                          minItems: 1
                          type: array
                          x-kubernetes-list-type: atomic
                          x-kubernetes-validations:
                          - message: addresses[].systemNetworkName must be unique
                            rule: self.all(x, self.exists_one(y, x.systemNetworkName
                              == y.systemNetworkName))
                        attached:
                          default: false
                          description: Attached indicates whether this member should
                            be attached (Primary in DRBD terms).
                          type: boolean
                        lvmVolumeGroupName:
                          description: LVMVolumeGroupName is the LVMVolumeGroup resource
                            name where this replica should be placed.
                          maxLength: 253
                          minLength: 1
                          pattern: ^[a-z0-9]([a-z0-9-.]{0,251}[a-z0-9])?$
                          type: string
                        lvmVolumeGroupThinPoolName:
                          description: LVMVolumeGroupThinPoolName is the thin pool
                            name (for LVMThin storage pools).
                          maxLength: 64
                          type: string
                        name:
                          description: |-
                            Name is the member name (used as list map key).
                            Must have format "prefix-N" where N is 0-31.
                          maxLength: 140
                          minLength: 1
                          type: string
                        nodeName:
                          description: NodeName is the Kubernetes node name where
                            the member is located.
                          maxLength: 253
                          minLength: 1
                          type: string
                        type:
                          description: Type is the member type.
                          enum:
                          - Diskful
                          - LiminalDiskful
                          - ShadowDiskful
                          - LiminalShadowDiskful
                          - TieBreaker
                          - Access
                          type: string
                        zone:
                          description: Zone is the zone where the member is located.
                          maxLength: 64
                          type: string
                      required:
                      - addresses
                      - attached
                      - name
                      - nodeName
                      - type
                      type: object
                      x-kubernetes-validations:
                      - message: name must contain '-' separator
                        rule: self.name.lastIndexOf('-') >= 0
                      - message: name numeric suffix must be between 0 and 31
                        rule: int(self.name.substring(self.name.lastIndexOf('-') +
                          1)) <= 31
                      - message: lvmVolumeGroupName can only be set for Diskful or
                          LiminalDiskful type
                        rule: '!has(self.lvmVolumeGroupName) || self.type == ''Diskful''
                          || self.type == ''LiminalDiskful'''
                      - message: lvmVolumeGroupThinPoolName requires lvmVolumeGroupName
                          to be set
                        rule: '!has(self.lvmVolumeGroupThinPoolName) || has(self.lvmVolumeGroupName)'
                    maxItems: 32
                    type: array
                    x-kubernetes-list-type: atomic
                    x-kubernetes-validations:
                    - message: members[].name must be unique
                      rule: self.all(x, self.exists_one(y, x.name == y.name))
                  multiattach:
                    default: false
                    description: Multiattach enables multiattach mode for the datamesh.
                    type: boolean
                  quorum:
                    default: 0
                    description: Quorum is the quorum value for the datamesh.
                    maximum: 13
                    minimum: 0
                    type: integer
                  quorumMinimumRedundancy:
                    default: 0
                    description: QuorumMinimumRedundancy is the minimum redundancy
                      required for quorum.
                    maximum: 8
                    minimum: 0
                    type: integer
                  sharedSecret:
                    description: SharedSecret is the shared secret for DRBD authentication.
                    maxLength: 256
                    type: string
                  sharedSecretAlg:
                    description: SharedSecretAlg is the hashing algorithm for the
                      shared secret.
                    enum:
                    - SHA256
                    - SHA1
                    - DummyForTest
                    type: string
                  size:
                    anyOf:
                    - type: integer
                    - type: string
                    description: Size is the desired size of the volume.
                    pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                    x-kubernetes-int-or-string: true
                  systemNetworkNames:
                    default: []
                    description: SystemNetworkNames is the list of system network
                      names for DRBD communication.
                    items:
                      maxLength: 64
                      type: string
                    maxItems: 10
                    type: array
                    x-kubernetes-list-type: atomic
                    x-kubernetes-validations:
                    - message: systemNetworkNames must be unique
                      rule: self.all(x, self.exists_one(y, x == y))
                required:
                - members
                - quorum
                - quorumMinimumRedundancy
                - size
                - systemNetworkNames
                type: object
              datameshReplicaRequests:
                description: DatameshReplicaRequests is the list of pending membership
                  requests from replicas.
                items:
                  description: ReplicatedVolumeDatameshReplicaRequest represents a
                    pending membership request from a single replica.
                  properties:
                    firstObservedAt:
                      description: FirstObservedAt is the timestamp when this request
                        was first observed.
                      format: date-time
                      type: string
                    message:
                      description: Message is an optional human-readable message about
                        the request state and progress.
                      maxLength: 512
                      type: string
                    name:
                      description: |-
                        Name is the replica name.
                        Must have format "prefix-N" where N is 0-31.
                      maxLength: 123
                      minLength: 1
                      pattern: ^.+-([0-9]|[12][0-9]|3[01])$
                      type: string
                    request:
                      description: Request is the membership change request details
                        from the replica.
                      properties:
                        lvmVolumeGroupName:
                          description: LVMVolumeGroupName is the LVMVolumeGroup resource
                            name for Diskful replicas.
                          minLength: 1
                          pattern: ^[a-z0-9]([a-z0-9-.]{0,251}[a-z0-9])?$
                          type: string
                        operation:
                          description: Operation is the type of membership change
                            requested.
                          enum:
                          - Join
                          - Leave
                          - ChangeRole
                          - ChangeBackingVolume
                          type: string
                        thinPoolName:
                          description: ThinPoolName is the thin pool name (optional,
                            for LVMThin storage pools).
                          type: string
                        type:
                          description: Type is the intended replica type. Required
                            for Join and ChangeRole operations.
                          enum:
                          - Diskful
                          - Access
                          - TieBreaker
                          type: string
                      required:
                      - operation
                      type: object
                      x-kubernetes-validations:
                      - message: type is required for Join and ChangeRole operations
                        rule: self.operation == 'Leave' || self.operation == 'ChangeBackingVolume'
                          || has(self.type)
                      - message: type/lvmVolumeGroupName/thinPoolName must not be
                          set for Leave
                        rule: self.operation != 'Leave' || (!has(self.type) && !has(self.lvmVolumeGroupName)
                          && !has(self.thinPoolName))
                      - message: ChangeBackingVolume requires lvmVolumeGroupName and
                          must not set type
                        rule: self.operation != 'ChangeBackingVolume' || (!has(self.type)
                          && has(self.lvmVolumeGroupName))
                      - message: lvmVolumeGroupName is required when type is Diskful
                        rule: '!has(self.type) || self.type != ''Diskful'' || has(self.lvmVolumeGroupName)'
                      - message: lvmVolumeGroupName must not be set when type is not
                          Diskful
                        rule: '!has(self.type) || self.type == ''Diskful'' || !has(self.lvmVolumeGroupName)'
                      - message: thinPoolName requires lvmVolumeGroupName to be set
                        rule: '!has(self.thinPoolName) || has(self.lvmVolumeGroupName)'
                  required:
                  - firstObservedAt
                  - name
                  - request
                  type: object
                maxItems: 32
                type: array
                x-kubernetes-list-type: atomic
                x-kubernetes-validations:
                - message: datameshReplicaRequests[].name must be unique
                  rule: self.all(x, self.exists_one(y, x.name == y.name))
              datameshRevision:
                description: DatameshRevision is a counter incremented when datamesh
                  configuration changes.
                format: int64
                type: integer
              datameshTransitions:
                description: DatameshTransitions is the list of active datamesh transitions.
                items:
                  description: |-
                    ReplicatedVolumeDatameshTransition represents an active datamesh transition.
                    Each transition has an ordered list of steps that are pre-declared on creation
                    and executed sequentially. The transition's start time is steps[0].startedAt.
                  properties:
                    fromReplicaType:
                      description: |-
                        FromReplicaType is the source replica type for ChangeReplicaType transitions.
                        Required for ChangeReplicaType. Must not be set for other types.
                      enum:
                      - Diskful
                      - Access
                      - TieBreaker
                      - ShadowDiskful
                      type: string
                    group:
                      description: |-
                        Group is the parallelism group for this transition.
                        Set by the controller at transition creation time. Read-only for users.
                        Provides observability: explains why a transition may be waiting.
                      enum:
                      - Formation
                      - VotingMembership
                      - NonVotingMembership
                      - Quorum
                      - Attachment
                      - Multiattach
                      - Emergency
                      type: string
                    planID:
                      description: |-
                        PlanID identifies the transition plan used to create this transition.
                        Used by the engine to look up step callbacks from the plan registry.
                      minLength: 1
                      type: string
                    replicaName:
                      description: |-
                        ReplicaName is the name of the replica this transition applies to.
                        Required for AddReplica, RemoveReplica, ChangeReplicaType, Attach, Detach, ForceRemoveReplica, ForceDetach.
                        Must not be set for Formation, EnableMultiattach, DisableMultiattach, ChangeQuorum.
                      maxLength: 123
                      minLength: 1
                      pattern: ^.+-([0-9]|[12][0-9]|3[01])$
                      type: string
                    replicaType:
                      description: |-
                        ReplicaType is the target replica type for AddReplica/RemoveReplica/ForceRemoveReplica.
                        Uses ReplicaType (Diskful, Access, TieBreaker, ShadowDiskful) — liminal states
                        (LiminalDiskful, LiminalShadowDiskful) are internal mechanics visible in step names,
                        not in transition parameters.
                        Required for AddReplica, RemoveReplica, ForceRemoveReplica. Must not be set for other types.
                      enum:
                      - Diskful
                      - Access
                      - TieBreaker
                      - ShadowDiskful
                      type: string
                    steps:
                      description: |-
                        Steps is the ordered list of steps for this transition.
                        All steps are written when the transition is created (with status=Pending,
                        and the first step immediately set to Active with startedAt).
                        Steps are executed sequentially — only one step is Active at a time.
                        Must have at least one element.
                      items:
                        description: ReplicatedVolumeDatameshTransitionStep represents
                          one step within a transition.
                        properties:
                          completedAt:
                            description: CompletedAt is set when the step transitions
                              from Active to Completed.
                            format: date-time
                            type: string
                          datameshRevision:
                            description: |-
                              DatameshRevision is the revision assigned when this step was activated.
                              0 if the step has not been activated yet or does not bump the revision.
                            format: int64
                            type: integer
                          message:
                            description: |-
                              Message is a per-step progress or error message.
                              Updated every reconciliation while the step is Active.
                            maxLength: 512
                            type: string
                          name:
                            description: Name is a human-readable step name (e.g.,
                              "Preconfigure", "attach", "✦ → D∅").
                            maxLength: 64
                            minLength: 1
                            type: string
                          startedAt:
                            description: StartedAt is set when the step transitions
                              from Pending to Active.
                            format: date-time
                            type: string
                          status:
                            default: Pending
                            description: Status is the current status of this step.
                            enum:
                            - Pending
                            - Active
                            - Completed
                            type: string
                        required:
                        - name
                        - status
                        type: object
                      maxItems: 8
                      minItems: 1
                      type: array
                      x-kubernetes-list-type: atomic
                    toReplicaType:
                      description: |-
                        ToReplicaType is the target replica type for ChangeReplicaType transitions.
                        Required for ChangeReplicaType. Must not be set for other types.
                      enum:
                      - Diskful
                      - Access
                      - TieBreaker
                      - ShadowDiskful
                      type: string
                    type:
                      description: Type is the transition type.
                      enum:
                      - Formation
                      - AddReplica
                      - Attach
                      - ChangeQuorum
                      - ChangeReplicaType
                      - Detach
                      - DisableMultiattach
                      - EnableMultiattach
                      - ForceDetach
                      - ForceRemoveReplica
                      - RemoveReplica
                      type: string
                  required:
                  - group
                  - steps
                  - type
                  type: object
                  x-kubernetes-validations:
                  - message: replicaName is required for AddReplica, RemoveReplica,
                      ChangeReplicaType, Attach, Detach, ForceRemoveReplica, ForceDetach
                      transitions
                    rule: self.type == 'Formation' || self.type == 'EnableMultiattach'
                      || self.type == 'DisableMultiattach' || self.type == 'ChangeQuorum'
                      || has(self.replicaName)
                  - message: replicaName must not be set for Formation, EnableMultiattach,
                      DisableMultiattach, ChangeQuorum transitions
                    rule: '!has(self.replicaName) || !(self.type == ''Formation''
                      || self.type == ''EnableMultiattach'' || self.type == ''DisableMultiattach''
                      || self.type == ''ChangeQuorum'')'
                  - message: replicaType must only be set for AddReplica, RemoveReplica,
                      ForceRemoveReplica transitions
                    rule: self.type == 'AddReplica' || self.type == 'RemoveReplica'
                      || self.type == 'ForceRemoveReplica' || !has(self.replicaType)
                  - message: replicaType is required for AddReplica, RemoveReplica,
                      ForceRemoveReplica transitions
                    rule: '!(self.type == ''AddReplica'' || self.type == ''RemoveReplica''
                      || self.type == ''ForceRemoveReplica'') || has(self.replicaType)'
                  - message: fromReplicaType and toReplicaType must only be set for
                      ChangeReplicaType transitions
                    rule: self.type == 'ChangeReplicaType' || (!has(self.fromReplicaType)
                      && !has(self.toReplicaType))
                  - message: fromReplicaType and toReplicaType are required for ChangeReplicaType
                      transitions
                    rule: self.type != 'ChangeReplicaType' || (has(self.fromReplicaType)
                      && has(self.toReplicaType))
                type: array
                x-kubernetes-list-type: atomic
              effectiveLayout:
                description: |-
                  EffectiveLayout tracks the FTT/GMDR levels that the datamesh actually
                  provides. q and qmr are computed from these values, not from Configuration.
                properties:
                  failuresToTolerate:
                    default: 0
                    description: FailuresToTolerate is the effective FTT level.
                    maximum: 2
                    minimum: 0
                    type: integer
                  guaranteedMinimumDataRedundancy:
                    default: 0
                    description: GuaranteedMinimumDataRedundancy is the effective
                      GMDR level.
                    maximum: 2
                    minimum: 0
                    type: integer
                required:
                - failuresToTolerate
                - guaranteedMinimumDataRedundancy
                type: object
              eligibleNodesViolations:
                description: EligibleNodesViolations lists replicas placed on non-eligible
                  nodes.
                items:
                  description: ReplicatedVolumeEligibleNodesViolation describes a
                    replica placed on a non-eligible node.
                  properties:
                    nodeName:
                      description: NodeName is the node where the replica is placed.
                      maxLength: 253
                      type: string
                    reason:
                      description: Reason describes why this placement violates eligible
                        nodes constraints.
                      type: string
                    replicaName:
                      description: ReplicaName is the ReplicatedVolumeReplica name.
                      maxLength: 253
                      type: string
                  required:
                  - nodeName
                  - reason
                  - replicaName
                  type: object
                maxItems: 32
                type: array
                x-kubernetes-list-type: atomic
                x-kubernetes-validations:
                - message: eligibleNodesViolations[].replicaName must be unique
                  rule: self.all(x, self.exists_one(y, x.replicaName == y.replicaName))
            required:
            - datamesh
            - datameshRevision
            - effectiveLayout
            type: object
        required:
        - metadata
        - spec
        type: object
        x-kubernetes-validations:
        - message: metadata.name must be at most 120 characters (to fit derived RVR/LLV
            names)
          rule: size(self.metadata.name) <= 120
    served: true
    storage: true
    subresources:
      status: {}
