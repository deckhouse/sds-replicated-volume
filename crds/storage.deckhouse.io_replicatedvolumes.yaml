---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  labels:
    module: sds-replicated-volume
  name: replicatedvolumes.storage.deckhouse.io
spec:
  group: storage.deckhouse.io
  names:
    kind: ReplicatedVolume
    listKind: ReplicatedVolumeList
    plural: replicatedvolumes
    shortNames:
    - rv
    singular: replicatedvolume
  scope: Cluster
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.conditions[?(@.type=='IOReady')].status
      name: IOReady
      type: string
    - jsonPath: .spec.size
      name: Size
      type: string
    - jsonPath: .status.actualSize
      name: ActualSize
      type: string
    - jsonPath: .status.diskfulReplicaCount
      name: DiskfulReplicas
      type: string
    - jsonPath: .status.phase
      name: Phase
      type: string
    name: v1alpha1
    schema:
      openAPIV3Schema:
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            properties:
              replicatedStorageClassName:
                minLength: 1
                type: string
              size:
                anyOf:
                - type: integer
                - type: string
                pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                x-kubernetes-int-or-string: true
            required:
            - replicatedStorageClassName
            - size
            type: object
          status:
            properties:
              actualSize:
                anyOf:
                - type: integer
                - type: string
                pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                x-kubernetes-int-or-string: true
              actuallyAttachedTo:
                items:
                  type: string
                maxItems: 2
                type: array
              attachedAndIOReadyCount:
                description: |-
                  AttachedAndIOReadyCount represents the number of attached replicas that are IOReady in format "ready/attached"
                  Example: "1/2" means 1 replica is IOReady out of 2 attached
                type: string
              conditions:
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              desiredAttachTo:
                description: |-
                  DesiredAttachTo is the desired set of nodes where the volume should be attached (up to 2 nodes).
                  It is computed by controllers from ReplicatedVolumeAttachment (RVA) objects.
                items:
                  type: string
                maxItems: 2
                type: array
              deviceMinor:
                description: DeviceMinor is a unique DRBD device minor number assigned
                  to this ReplicatedVolume.
                format: int32
                maximum: 1048575
                minimum: 0
                type: integer
              diskfulReplicaCount:
                description: |-
                  DiskfulReplicaCount represents the current and desired number of diskful replicas in format "current/desired"
                  Example: "2/3" means 2 current diskful replicas out of 3 desired
                type: string
              diskfulReplicasInSync:
                description: |-
                  DiskfulReplicasInSync represents the number of diskful replicas that are in sync in format "inSync/total"
                  Example: "2/3" means 2 diskful replicas are in sync out of 3 total diskful replicas
                type: string
              drbd:
                properties:
                  config:
                    properties:
                      allowTwoPrimaries:
                        default: false
                        type: boolean
                      quorum:
                        maximum: 8
                        minimum: 0
                        type: integer
                      quorumMinimumRedundancy:
                        maximum: 8
                        minimum: 0
                        type: integer
                      sharedSecret:
                        minLength: 1
                        type: string
                      sharedSecretAlg:
                        enum:
                        - SHA256
                        - SHA1
                        - DummyForTest
                        type: string
                    type: object
                type: object
              eligibleNodesViolations:
                description: EligibleNodesViolations lists replicas placed on non-eligible
                  nodes.
                items:
                  description: ReplicatedVolumeEligibleNodesViolation describes a
                    replica placed on a non-eligible node.
                  properties:
                    nodeName:
                      description: NodeName is the node where the replica is placed.
                      type: string
                    reason:
                      description: Reason describes why this placement violates eligible
                        nodes constraints.
                      type: string
                    replicaName:
                      description: ReplicaName is the ReplicatedVolumeReplica name.
                      type: string
                  required:
                  - nodeName
                  - reason
                  - replicaName
                  type: object
                type: array
              phase:
                type: string
              rolloutTicket:
                description: |-
                  RolloutTicket is assigned when the volume is created and updated when selected for rolling update.
                  Persists the last taken storage class configuration snapshot.
                properties:
                  configuration:
                    description: Configuration is the configuration snapshot to roll
                      out.
                    properties:
                      replication:
                        description: Replication is the replication mode from the
                          storage class.
                        type: string
                      systemNetworkNames:
                        description: SystemNetworkNames is the list of network names
                          from the storage class.
                        items:
                          type: string
                        type: array
                      topology:
                        description: Topology is the topology setting from the storage
                          class.
                        type: string
                      volumeAccess:
                        description: VolumeAccess is the volume access mode from the
                          storage class.
                        type: string
                      zones:
                        description: Zones is the list of zones from the storage class.
                        items:
                          type: string
                        type: array
                    required:
                    - replication
                    - topology
                    - volumeAccess
                    type: object
                  storageClassGeneration:
                    description: StorageClassGeneration is the RSC generation this
                      ticket was issued for.
                    format: int64
                    type: integer
                required:
                - configuration
                - storageClassGeneration
                type: object
              storageClass:
                description: StorageClass tracks the observed state of the referenced
                  ReplicatedStorageClass.
                properties:
                  name:
                    description: Name is the ReplicatedStorageClass name.
                    type: string
                  observedEligibleNodesChecksum:
                    description: ObservedEligibleNodesChecksum is the checksum of
                      eligible nodes when last observed.
                    type: string
                  observedGeneration:
                    description: ObservedGeneration is the generation of RSC when
                      last observed.
                    format: int64
                    type: integer
                required:
                - name
                type: object
              targetConfiguration:
                description: TargetConfiguration is the desired configuration snapshot
                  for this volume.
                properties:
                  replication:
                    description: Replication is the replication mode from the storage
                      class.
                    type: string
                  systemNetworkNames:
                    description: SystemNetworkNames is the list of network names from
                      the storage class.
                    items:
                      type: string
                    type: array
                  topology:
                    description: Topology is the topology setting from the storage
                      class.
                    type: string
                  volumeAccess:
                    description: VolumeAccess is the volume access mode from the storage
                      class.
                    type: string
                  zones:
                    description: Zones is the list of zones from the storage class.
                    items:
                      type: string
                    type: array
                required:
                - replication
                - topology
                - volumeAccess
                type: object
            type: object
        required:
        - metadata
        - spec
        type: object
        x-kubernetes-validations:
        - message: metadata.name must be at most 120 characters (to fit derived RVR/LLV
            names)
          rule: size(self.metadata.name) <= 120
    served: true
    storage: true
    subresources:
      status: {}
